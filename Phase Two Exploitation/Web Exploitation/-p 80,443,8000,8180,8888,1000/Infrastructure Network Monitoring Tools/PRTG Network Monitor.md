# Discovery/Footprinting/Enumeration
We can quickly discover PRTG from an Nmap scan. It can typically be found on common web ports such as 80, 443, or 8080. PRTG also shows up in the EyeWitness scan we performed earlier. Here we can see that EyeWitness lists the default credentials prtgadmin:prtgadmin. They are typically pre-filled on the login page, and we often find them unchanged. Vulnerability scanners such as Nessus also have plugins that detect the presence of PRTG.
Once we have discovered PRTG, we can confirm by browsing to the URL and are presented with the login page. 
Example: 
From the enumeration we performed so far, it seems to be PRTG version 17.3.33.2830 and is likely vulnerable to CVE-2018-9276 which is an authenticated command injection in the PRTG System Administrator web console for PRTG Network Monitor before version 18.2.39.
Using cURL we can see that the version number is indeed 17.3.33.283.
```
curl -s http://10.129.201.50:8080/index.htm -A "Mozilla/5.0 (compatible; MSIE 7.01; Windows NT 5.0)" | grep version
```
Our first attempt to log in with the default credentials fails, but a few tries later, we are in with prtgadmin:Password123.

# Leveraging Known Vulnerabilities
When creating a new notification, the Parameter field is passed directly into a PowerShell script without any type of input sanitization.
1. To begin, mouse over Setup in the top right and then the Account Settings menu and finally click on Notifications.
2. Next, click on Add new notification
3. Give the notification a name and scroll down and tick the box next to EXECUTE PROGRAM. Under Program File, select Demo exe notification - outfile.ps1 from the drop-down. 
4. Finally, in the parameter field, enter a command.
5. For our purposes, we will add a new local admin user by entering
```
test.txt;net user prtgadm1 Pwn3d_by_PRTG! /add;net localgroup administrators prtgadm1 /add
```
6. click the Save button
7. After clicking Save, we will be redirected to the Notifications page and see our new notification named pwn in the list
8. After clicking Test we will get a pop-up that says EXE notification is queued up (Bell icon on the top right)
	1. We can use CrackMapExec to confirm local admin access
	2. We could also try to RDP to the box, access over WinRM, or use a tool such as evil-winrm or something from the impacket toolkit such as wmiexec.py or psexec.py
```
sudo crackmapexec smb 10.129.201.50 -u prtgadm1 -p Pwn3d_by_PRTG!
```
