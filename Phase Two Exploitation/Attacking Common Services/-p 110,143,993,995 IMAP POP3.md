Access to emails from a mail server is possible. IMAP works unencrypted and transmits commands, emails, or usernames and passwords in plain text. Depending on the method and implementation used, the encrypted connection uses the standard port 143 or an alternative port such as 993. If we successfully figure out the access credentials for one of the employees, an attacker could log in to the mail server and read or even send the individual messages.
## cURL
```
curl -k 'imaps://10.129.14.128' --user user:p4ssw0rd
```
```
curl -k 'imaps://10.129.14.128' --user cry0l1t3:1234 -v
```
## OpenSSL
### OpenSSL - TLS Encrypted Interaction POP3
```
openssl s_client -connect 10.129.14.128:pop3s
```
### OpenSSL - TLS Encrypted Interaction IMAP
```
openssl s_client -connect 10.129.14.128:imaps
```
Check the commands https://book.hacktricks.xyz/network-services-pentesting/pentesting-imap
# Enumeration
We can use the Mail eXchanger (MX) DNS record to identify a mail server. The MX record specifies the mail server responsible for accepting email messages on behalf of a domain name
```
host -t MX <domain.com>
```
```
dig mx plaintext.do | grep "MX" | grep -v ";"
```
```
host -t A mail1.inlanefreight.htb.
```
We can use Nmap's default script -sC option to enumerate those ports on the target system:
```
sudo nmap -Pn -sV -sC -p25,143,110,465,587,993,995 <ip>
```
# Protocol Specifics Attacks
## Password Attacks
### Hydra - Password Attack
```
hydra -L users.txt -p 'Company01!' -f 10.10.110.20 pop3 (or smtp,imap4)
```
## Misconfigurations
We can also use the POP3 protocol to enumerate users depending on the service implementation. For example, we can use the command USER followed by the username, and if the server responds OK. This means that the user exists on the server.
```
telnet <ip> 110
```
```
USER <username>
PASS <password>
```
To check emails
```
RETR 1
RETR 2
```